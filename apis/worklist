orderTable = {"goto",
	      "gohome",
	      "face",
	      "wall",
	      "floor",
	      "tower",
	      "complete"}


function parseArgs(args)
   local result = {}
   for x in string.gmatch(args, "(-?%w+)") do
      if string.match(x, "-?%d+") then
	 table.insert(result, tonumber(x))
      else
	 table.insert(result, x)
      end
   end
   return(result)
end
	 
			   


function processOrder(message)
   local order, args = string.match(message, "([^ ]+) (.+)")
   if not order then
      order = string.match(message, "(%w+)")
   end
   for i,o in pairs(orderTable) do
      if o == order then
	 if args == nil then
	    return o, {}
	 else
	    return o, parseArgs(args)
	 end
      end
   end
   
   error("Unknown order" .. tostring(order) .. " args=" .. tostring(args))
end


function load(filename)
   local fp = fs.open(filename, "r")
   local worklist = {}
   local workchunk = {}
   repeat 
      local line = fp.readLine()
      if line == "--" then
	 if not #workchunk == 0 then
	    table.insert(worklist, workchunk)
	 end	 
      elseif line and line ~= "" then
	 local work, args = processOrder(line)
	 table.insert(workchunk, {work, unpack(args)})
      else
	 table.insert(worklist, workchunk)
      end
   until line == nil
   return(worklist)
end
	    
	 